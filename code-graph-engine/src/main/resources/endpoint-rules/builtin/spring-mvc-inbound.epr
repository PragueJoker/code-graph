name: "Spring MVC Inbound"
description: "解析 Spring MVC Controller 的 HTTP 入口端点"
version: "1.0"
enabled: true  # 重新启用
priority: 100
type: "http-inbound"

scope:
  packageIncludes:
    - "**.controller"
    - "**.controller.**"
    - "**.web"
    - "**.web.**"
  packageExcludes:
    - "**/src/test/**"  # 排除源码中的测试目录，不排除测试用例中的模拟路径

locate:
  nodeType: "MethodDeclaration"
  where:
    - hasAnnotation:
        nameMatches: "@(RequestMapping|GetMapping|PostMapping|PutMapping|DeleteMapping|PatchMapping)"

extract:
  httpMethod:
    strategies:
      # 策略1：从 @GetMapping/@PostMapping 等注解名提取方法
      - tryConfig:
          from: "method.annotation[.*Mapping$].name"
          pattern: "(Get|Post|Put|Delete|Patch)Mapping"
          captureGroup: 1
          transform: "toUpperCase"
        onSuccess: "return"
      # 策略2：从 @RequestMapping 的 method 属性提取
      - tryConfig:
          from: "method.annotation[@RequestMapping].attribute[method]"
          defaultValue: "GET"
  
  basePath:
    strategies:
      # 尝试 value 属性
      - tryConfig:
          from: "class.annotation[@RequestMapping].attribute[value]"
        onSuccess: "return"
      # 尝试 path 属性
      - tryConfig:
          from: "class.annotation[@RequestMapping].attribute[path]"
        onSuccess: "return"
      # 都失败了，使用默认值
      - tryConfig:
          defaultValue: ""
  
  methodPath:
    strategies:
      # 尝试 value 属性
      - tryConfig:
          from: "method.annotation[.*Mapping$].attribute[value]"
        onSuccess: "return"
      # 尝试 path 属性
      - tryConfig:
          from: "method.annotation[.*Mapping$].attribute[path]"
        onSuccess: "return"
      # 都失败了，使用默认值
      - tryConfig:
          defaultValue: ""
  
  path:
    combine:
      sources:
        - source: "${basePath}"
        - source: "${methodPath}"
      normalize: true

